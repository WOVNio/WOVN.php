version: 2

jobs:
  build:
    docker:
      - image: circleci/php
    steps:
      - checkout
      - setup_remote_docker
      - restore_cache:
          keys:
            - vendor-{{ checksum "composer.lock" }}
            - vendor-
      - run: composer install
      - save_cache:
          key: vendor-{{ checksum "composer.lock" }}
          paths: vendor
      - run: ./vendor/bin/phpcs
      - run: scripts/run_phpunit_tests.sh vectorface/php5.3
      - run: scripts/run_phpunit_tests.sh vectorface/php5.4
      - run: scripts/run_phpunit_tests.sh php:5.5-apache
      - run: scripts/run_phpunit_tests.sh php:5.6-apache
      - run: scripts/run_phpunit_tests.sh vectorface/hhvm
      - run: scripts/run_phpunit_tests.sh php:7.0-apache
      - run: scripts/run_phpunit_tests.sh php:7.1-apache
      - run: scripts/run_phpunit_tests.sh php:7.2-apache
      - run: scripts/run_phpunit_tests.sh php:7.3-apache
      - run: scripts/run_server_tests.sh php:5.3-apache
      - run: scripts/run_server_tests.sh php:5.4-apache
      - run: scripts/run_server_tests.sh php:5.5-apache
      - run: scripts/run_server_tests.sh php:5.6-apache
      - run: scripts/run_server_tests.sh php:7.0-apache
      - run: scripts/run_server_tests.sh php:7.1-apache
      - run: scripts/run_server_tests.sh php:7.2-apache
      - run: scripts/run_server_tests.sh php:7.3-apache
